#include <Arduino.h>
#include <SoftwareSerial.h>

#define RX		6 // RS485 Receive pin
#define TX		7 // RS485 Transmit pin
#define DE    8 // RS485 direction control pin

// RS485 direction control flags
#define RS485Transmit HIGH
#define RS485Receive LOW

SoftwareSerial RS485(RX, TX);

int analogPin = A3;

byte key1[11] = {0x01, 0x06, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x97, 0x8A}; // enable
byte key2[11] = {0x01, 0x06, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xA4, 0x8A}; // reset
byte key3[11] = {0x01, 0x06, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC2, 0x8A}; // going forward
byte key4[11] = {0x01, 0x06, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0E, 0x8A}; // turn left
byte key5[11] = {0x01, 0x06, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x96, 0x8B}; // clockwise
byte key6[11] = {0x01, 0x06, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x46, 0x89}; // emergency stop
byte key7[11] = {0x01, 0x06, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x66, 0x8B}; // lift down
byte key8[11] = {0x01, 0x06, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x76, 0x8A}; // back
byte key9[11] = {0x01, 0x06, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0xFE, 0x8A}; // turn right
byte key10[11] = {0x01, 0x06, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0xBA, 0x8A}; // counter clockwise

void setup() {
  Serial.begin(9600);
  pinMode(DE, OUTPUT); 
  digitalWrite(DE, RS485Receive);
  RS485.begin(115200);
}

void loop() {
  // int sensor_val = analogRead(analogPin); // 0 - 1023
  // Serial.println(sensor_val);
  // delay(100);

  Serial.println("Type 1 if you want to move the robot forward");
  int input = Serial.parseInt();
  if (input == 1) {
    Serial.println("Moving the robot forward");
    digitalWrite(DE, RS485Transmit);
    for (int i = 0; i < 11; i++) {
      byte sendByte = key2[i];
      RS485.write(sendByte);
    }
    digitalWrite(DE, RS485Receive);
  }

  if (RS485.available()) {
    byte readByte = RS485.read();
    Serial.println(readByte);
  }

}
